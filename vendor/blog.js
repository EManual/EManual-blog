!function(e){"use strict";function t(e){return-1!==e.indexOf("//")}function i(e){return e.slice(0,e.lastIndexOf("/")+1)}function a(e){return-1!==e.toLowerCase().indexOf(".md")||-1!==e.toLowerCase().indexOf(".markdown")}function n(t,i){e(window).trigger(t,i)}function r(e,t){"/"==e[e.length-1]&&(e=e.substring(0,e.length-1));var i=e.split("/"),a=t.split("/");if("."==a[0])a.splice(0,1);else{if(".."!=a[0])return-1!=a[0].indexOf("http")||-1!=a[0].indexOf("https")?t:i.join("/")+"/"+a.join("/");i.splice(i.length-1,1),a.splice(0,1)}return r(i.join("/"),a.join("/"))}function o(f,c,g,m){var m=m||s,g=g||!1,p=m+c;e.get(p,function(o){marked.setOptions({highlight:function(e){return hljs.highlightAuto(e).value}});var c=e(f);if(c.html(marked(o)),c.find("[href]").each(function(){var n=e(this),o=n.attr("href");if(t(o)&&n.attr("target","_blank"),g&&a(o)&&n.attr("href","?"+o),!t(o)&&!g&&a(o)){var f=i(h);0==o.indexOf("../")?f=r(i(h),o):0==o.indexOf("__P__")?f=o.replace("__P__/",""):f+=o.replace("./",""),n.attr("href","?"+f)}}),!g){var d=e("#main-page").find("h1, h2, h3, h4, h5, h6").first().text();e("title").text(d),e.each(c.find("img"),function(t,i){var a=e(i).attr("alt")||"";e(i).addClass(-1!=a.indexOf("|left")?"img-left":-1!=a.indexOf("|right")?"img-right":"img-center")})}g&&(c.find("img").first().addClass("avatar"),e.each(c.find("li"),function(t,i){e(i).addClass("sidebar-item")})),e.each(c.find("img"),function(t,a){var n=e(a);if(0==n.attr("src").indexOf("__IMG__"))n.attr("src",n.attr("src").replace("__IMG__",l));else{var o=r(i(p),n.attr("src"));n.attr("src",o)}}),"#sidebar-page"==f?n("loaded-sidebar-page"):"#main-page"==f?n("loaded-main-page"):"#main-page-footer"==f&&n("loaded-main-page-footer")}).fail(function(e){if(404===e.status){if("footer.md"===c)return void console.log("没有找到footer.md! 建议在p/目录下建立footer.md 文件来添加底部信息！");o("#main-page","404.md",!1,"/"+d+"/"),n("page-not-found",{selector:f,path:c})}})}function f(t){e.getJSON("config.json",{},function(i){d=i.app_name||d,l=i.img_root||l;var a=i.description||"";g=i.markdown_root||g,s="/"+d+"/"+g+"/",e("meta[name=description]").first().attr("content",a),t()}).fail(function(e){alert("读取配置有误")})}function c(){f(function(){n("before-load-sidebar-page"),o("#sidebar-page","sidebar.md",!0),n("before-load-main-page-footer"),o("#main-page-footer","footer.md"),h=-1!==location.search.indexOf("&")?location.search.slice(1,location.search.indexOf("&")):location.search.slice(1,location.search.length),"/"===h.charAt(h.length-1)&&(h=h.slice(0,location.search.length-2)),""!==h&&a(h)?(n("before-load-main-page"),o("#main-page",h)):(n("before-load-main-page"),o("#main-page","home.md"))})}var d="",s="",l="img",g="p",h="";c()}(jQuery);